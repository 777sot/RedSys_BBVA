{"name":"Sermepa","tagline":"Clase para utilizar la pasarela de pagos sermepa","body":"Historia\r\n--------\r\nEsta clase nace porque no te encontraba una clase de pasarela de pagos (TPV) que se pueda integrar directamente en una web, existen\r\nmuchas pero para varios CMS y no me servian, solo quería montar algo fácil que pueda usar, los ejemplos que vienen en la documentación oficial era muy simple así que decidi realizar esta clase y ahora lo comparto con todos.\r\n    \r\n    Valido para Sermepa y Redsys.\r\n\r\nIntroducción\r\n------------\r\nLa clase sermepa sirve para generar el formulario que se comunicará con la pasarela de pagos que usan muchos bancos como: Sabadell, Lacaixa, etc.\r\n\r\nEs una versión que ira creciendo y actualizandose poco a poco y mejorandolo.\r\nSi lo usas en algún proyecto y te ayudo en algo no dudas en decirmelo\r\n\r\nRequerimientos\r\n--------------\r\nPHP 5\r\n\r\nCreditos\r\n--------\r\n    Clase creada por Eduardo Diaz, Madrid 2012\r\n    Twitter: @eduardo_dx\r\n\r\nComo usar la clase\r\n------------------\r\nPrimeramente decargamos la clase\r\ngit clone git@github.com:ssheduardo/sermepa.git\r\n\r\nEjemplo\r\nPrimero asignamos los parámetros\r\n\r\n    try{\r\n        $pasarela = new Sermepa();\r\n        $pasarela->importe(10.50);\r\n        $pasarela->pedido(date('ymdHis'));  //generamos el número de recibo usando date por ejemplo\r\n        $pasarela->clave('xxxxxxx');    //clave asignada por el banco.\r\n        $pasarela->codigofuc('xxxxxxx');\r\n        $pasarela->producto_descripcion('Demo');\r\n        $pasarela->titular('Usuario');\r\n        $pasarela->nombre_comercio('Ejemplo');\r\n        //Si el comercio tiene notificación \"on-line\". URL del comercio que recibirá un post con los datos de la transacción .\r\n        $pasarela->url_notificacion('http://www.example.com/notificacion.php'); \r\n        $pasarela->url_ok('http://www.example.com/ok.php'); // Si le das aceptar finalizada la compra desde la pasarela de pagos\r\n        $pasarela->url_ko('http://www.example.com/ko.php'); // Si le das cancelar desde la pasarela de pagos\r\n        $pasarela->firma();\r\n    }\r\n    catch(Exception $e){\r\n        echo $e->getMessage();   \r\n    }\r\n\r\nOpcional\r\n\r\n    //Asigna nombre a id y name del formulario\r\n    $pasarela->set_nameform('nombre_formulario');   \r\n    //Generar el input submit (si en caso no se usa javascript u otro)\r\n    $pasarela->submit('nombre_submit','texto_del_boton');\r\n\r\n\r\nGeneramos el formulario\r\n\r\n    $formulario = $pasarela->create_form();\r\n\r\nCon esto generamos el form para la comunicación con la pasarela de pagos.\r\nSolo queda agregar un input submit personalizado o por medio de javascript realizar el submit.\r\n\r\nRedirección automática\r\n\r\n    //Gracias por a la colaboración de jaumecornado (github)\r\n    Podemos forzar la redirección sin pasar por el método create_form()\r\n    $pasarela->ejecutarRedireccion(); \r\n    \r\n    [Esto método llamaría a create_form y lanzaría el submit por javacript]\r\n\r\nComprobación de Pago\r\n\r\n    //Gracias por a la colaboración de markitosgv (github)\r\n    Podemos comprobar si se ha realizado el pago correctamente. Para ello necesitamos setear la clave del banco y pasar la variable $_POST que nos devuelve en la URL de notificación o de retorno. Por ejemplo, en el fichero que es llamado por la URL de retorno:\r\n\r\n    try{\r\n        $pasarela = new Sermepa();\r\n        $pasarela->clave('xxxxxxx');    //clave asignada por el banco.\r\n        if ($pasarela->comprobar($_POST)) {\r\n            //acciones a realizar si es correcto, por ejemplo validar una reserva, mandar un mail de OK, guardar en bbdd o contactar con mensajería para preparar un pedido\r\n        } else {\r\n            //acciones a realizar si ha sido erroneo\r\n        }\r\n    }\r\n    catch(Exception $e){\r\n        echo $e->getMessage();\r\n    }\r\n\r\n>Nota:\r\n    Por defecto se conecta por la pasarela de pruebas para cambiar a un entorno real usar el método: set_entorno('real'), con esto ya estará activo.\r\n\r\n\r\n    \r\n","google":"UA-30551403-1","note":"Don't delete this file! It's used internally to help with page regeneration."}